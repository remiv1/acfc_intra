<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bon de Commande #{{ commande.id }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='commandes/css/commandes.css') }}">
</head>
<body class="bon-commande-body">
    <div class="bon-commande">
        <!-- En-tête -->
        <div class="header">
            <div class="titre-principal">BON DE COMMANDE</div>
            <div class="date-commande">
                Date de commande<br>
                <strong>{{ commande.date_commande|strftime }}</strong>
            </div>
        </div>

        <!-- Informations principales -->
        <div class="info-commande">
            <div class="info-left">
                <div class="numero-commande">N° {{ commande.id }}</div>
                <div class="client-nom">{{ commande.client.nom_affichage }}</div>
                {% if commande.descriptif %}
                <div class="descriptif-commande">
                    {{ commande.descriptif }}
                </div>
                {% endif %}
            </div>
            <div class="info-right">
                <div class="montant-commande">{{ "%.2f"|format(commande.montant) }} €</div>
                <div class="info-articles">
                    {{ devises_factures|length }} article{{ 's' if devises_factures|length > 1 else '' }}
                </div>
            </div>
        </div>

        <!-- Produits commandés -->
        <div class="produits-section">
            <div class="produits-titre">Articles commandés</div>
            <table class="produits-table">
                <thead>
                    <tr>
                        <th class="col-reference">Réf.</th>
                        <th class="col-designation">Désignation</th>
                        <th class="col-qte text-center">Qté</th>
                        <th class="col-prix text-right">P.U.</th>
                        <th class="col-remise text-center">Rem.</th>
                        <th class="col-total text-right">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for devise in devises_factures %}
                    <tr>
                        <td class="reference">{{ devise.reference }}</td>
                        <td class="designation">{{ devise.designation }}</td>
                        <td class="text-center">{{ devise.qte }}</td>
                        <td class="text-right">{{ "%.2f"|format(devise.prix_unitaire) }} €</td>
                        <td class="text-center">{{ "%.0f"|format(devise.remise * 100) }}%</td>
                        <td class="text-right"><strong>{{ "%.2f"|format(devise.qte * devise.prix_unitaire * (1 - devise.remise)) }} €</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="5" class="total-label">TOTAL COMMANDE :</td>
                        <td class="text-right total-amount">{{ "%.2f"|format(commande.montant) }} €</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <!-- Footer avec QR Code -->
        <div class="footer">
            <div class="qr-section">
                <div class="qr-code">
                    <img src="data:image/png;base64,{{ qr_code_base64 }}" alt="QR Code" width="80" height="80">
                </div>
                <div class="qr-url">{{ commande_url }}</div>
            </div>
            <div class="footer-info">
                <div>Généré le {{ now|strftime }}</div>
                <div>ACFC - Système de gestion</div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='commandes/js/commandes_unified.js') }}"></script>
    <script>
        // Initialisation spécifique au bon d'impression
        initializeBonImpressionFeatures();
    </script>
</body>
</html>
